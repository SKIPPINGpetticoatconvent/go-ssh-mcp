# SSH MCP 服务端

[English Version](./README.md)

基于 [Model Context Protocol (MCP)](https://modelcontextprotocol.io/) 实现的 SSH 命令执行服务端，提供安全、高效的远程命令执行能力。

## 功能特性

- **连接池管理**: 复用 SSH 连接，减少握手开销，显著提升执行效率。
- **PTY (伪终端) 支持**: 支持交互式命令（如 `top`, `htop`, `vim`），通过请求伪终端解决交互问题。
- **自动重连**: 智能检测断开的连接并尝试自动重连，提高系统稳定性。
- **输出截断保护**: 针对大文件（如海量日志）自动截断，仅保留最后 2000 字节，防止 MCP 协议缓冲区溢出。
- **安全卫士**: 内置命令黑名单过滤逻辑，防止执行危险命令（如 `rm -rf /`）。
- **结构化错误处理**: `stdout` 与 `stderr` 分离捕获，提供精准的错误排查信息。
- **多重认证**: 同时支持密码认证与私钥（PEM 格式）认证。

## 安装说明

```bash
go build -o ssh-mcp main.go
```

## 使用指南

在您的 MCP 客户端（如 Claude Desktop）中配置如下：

### 工具参数说明

`ssh_execute` 工具支持以下参数：

| 参数名 | 必填 | 描述 |
|-----------|----------|-------------|
| `host` | 是 | 远程主机地址 (例如: `127.0.0.1`) |
| `port` | 是 | SSH 端口 (默认为 `22`) |
| `user` | 是 | 远程登录用户名 |
| `password`| 否 | SSH 登录密码 (使用私钥时可选) |
| `privateKey`| 否 | SSH 私钥内容 (PEM 格式) |
| `command` | 是 | 要执行的命令 |
| `workingDir`| 否 | 命令执行的工作目录 |
| `usePty` | 否 | 是否启用 PTY (用于交互式命令) |

## 开源协议

MIT
